// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-inherit@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-property@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/buffer-ctor@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-next-tick@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-regexp@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/buffer-from-string@esm/index.mjs";function c(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var h="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function b(){throw new Error("setTimeout has not been defined")}function g(){throw new Error("clearTimeout has not been defined")}var j=b,v=g;function w(e){if(j===setTimeout)return setTimeout(e,0);if((j===b||!j)&&setTimeout)return j=setTimeout,setTimeout(e,0);try{return j(e,0)}catch(t){try{return j.call(null,e,0)}catch(t){return j.call(this,e,0)}}}"function"==typeof h.setTimeout&&(j=setTimeout),"function"==typeof h.clearTimeout&&(v=clearTimeout);var x,y=[],_=!1,T=-1;function O(){_&&x&&(_=!1,x.length?y=x.concat(y):T=-1,y.length&&M())}function M(){if(!_){var e=w(O);_=!0;for(var t=y.length;t;){for(x=y,y=[];++T<t;)x&&x[T].run();T=-1,t=y.length}x=null,_=!1,function(e){if(v===clearTimeout)return clearTimeout(e);if((v===g||!v)&&clearTimeout)return v=clearTimeout,clearTimeout(e);try{v(e)}catch(t){try{return v.call(null,e)}catch(t){return v.call(this,e)}}}(e)}}function E(e,t){this.fun=e,this.array=t}E.prototype.run=function(){this.fun.apply(null,this.array)};function S(){}var k=S,P=S,W=S,q=S,D=S,N=S,R=S;var H=h.performance||{},I=H.now||H.mozNow||H.msNow||H.oNow||H.webkitNow||function(){return(new Date).getTime()};var A=new Date;var L={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new E(e,t)),1!==y.length||_||w(M)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:k,addListener:P,once:W,off:q,removeListener:D,removeAllListeners:N,emit:R,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*I.call(H),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-A)/1e3}},z=require("stream");"disable"===L.env.READABLE_STREAM&&z?(module.exports=z,exports=module.exports=z.Readable,exports.Readable=z.Readable,exports.Writable=z.Writable,exports.Duplex=z.Duplex,exports.Transform=z.Transform,exports.PassThrough=z.PassThrough,exports.Stream=z):(exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=z||exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js"));var C=c(Object.freeze({__proto__:null})),J={objectMode:!1,encoding:null,allowHalfOpen:!1,writableObjectMode:!1,sep:null},V=s,B=a,F=l.isPrimitive,G=d.isPrimitive,K=u.isPrimitive,Q=p,U=f;var X=function(e,t){return V(t)?!B(t,"sep")||(e.sep=t.sep,K(e.sep)||Q(e.sep))?B(t,"objectMode")&&(e.objectMode=t.objectMode,!F(e.objectMode))?new TypeError(U("invalid option. `%s` option must be a boolean. Option: `%s`.","objectMode",e.objectMode)):B(t,"writableObjectMode")&&(e.writableObjectMode=t.writableObjectMode,!F(e.writableObjectMode))?new TypeError(U("invalid option. `%s` option must be a boolean. Option: `%s`.","writableObjectMode",e.writableObjectMode)):B(t,"encoding")&&(e.encoding=t.encoding,!K(e.encoding))?new TypeError(U("invalid option. `%s` option must be a string. Option: `%s`.","encoding",e.encoding)):B(t,"allowHalfOpen")&&(e.allowHalfOpen=t.allowHalfOpen,!F(e.allowHalfOpen))?new TypeError(U("invalid option. `%s` option must be a boolean. Option: `%s`.","allowHalfOpen",e.allowHalfOpen)):B(t,"highWaterMark")&&(e.highWaterMark=t.highWaterMark,!G(e.highWaterMark))?new TypeError(U("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","highWaterMark",e.highWaterMark)):null:new TypeError(U("invalid option. `%s` option must be either a string or a regular expression. Option: `%s`.","sep",e.sep)):new TypeError(U("invalid argument. Options argument must be an object. Value: `%s`.",t))};module.exports=void 0!==L&&"renderer"===L.type?require("./browser.js"):require("./node.js");var Y=c(Object.freeze({__proto__:null}))("split-stream"),Z=m;var $=function(e,t){return"utf8"===t||"buffer"===t?e:(e=Z(e),t?e.toString(t):e.toString())},ee=C.Transform,te=t,re=n,ne=e,ie=i,oe=o,se=J,ae=X,le=Y,de=$,ue=/\r?\n/;function pe(e){var t,r;if(!(this instanceof pe))return arguments.length?new pe(e):new pe;if(t=te(se),arguments.length&&(r=ae(t,e)))throw r;return t.readableObjectMode=!0,t.decodeStrings=!1,le("Creating a transform stream configured with the following options: %s.",JSON.stringify(t)),ee.call(this,t),ne(this,"_sep",null===t.sep?ue:t.sep),re(this,"_destroyed",!1),ne(this,"_encoding",t.encoding),re(this,"_buffer",""),re(this,"_idx",-1),this}r(pe,ee),ne(pe.prototype,"_transform",(function(e,t,r){var n,i,o,s;if(this._idx+=1,le("Received a new chunk. Chunk: %s. Encoding: %s. Index: %d.",e.toString(),t,this._idx),"buffer"===t?e=e.toString():"utf8"!==t&&(e=(e=new ie(e,t)).toString("utf8")),n=e.split(this._sep),le("Splits: %s. Index: %d.",JSON.stringify(n),this._idx),o=n.length-1,le("%s splits. Index: %d.",o,this._idx),0===o)le("No splits. Index: %d.",this._idx),this._buffer+=n[o];else{for(le("Processing splits. Index: %d.",this._index),i=this._buffer+n[0],i=de(i,t),le("Split %d: %s. Index: %d.",0,i.toString(),this._idx),this.push(i,t),s=1;s<o;s++)i=de(n[s],t),le("Split %d: %s. Index: %d.",s,i.toString(),this._idx),this.push(i,t);le("Remaining split: %s.",n[o].toString()),this._buffer=n[o]}r()})),ne(pe.prototype,"_flush",(function(e){var t=this._buffer;t&&(le("Processing final split..."),t=de(t,this._encoding),this.push(t,this._encoding)),le("Flushing the stream..."),e()})),ne(pe.prototype,"destroy",(function(e){var t;return this._destroyed?(le("Attempted to destroy an already destroyed stream."),this):(t=this,this._destroyed=!0,oe((function(){e&&(le("Stream was destroyed due to an error. Error: %s.",JSON.stringify(e)),t.emit("error",e));le("Closing the stream..."),t.emit("close")})),this)}));var fe=s,me=f,ce=t,he=pe;var be=s,ge=f,je=t,ve=pe;var we=e,xe=pe,ye=function(e){var t;if(arguments.length){if(!fe(e))throw new TypeError(me("invalid argument. Options argument must be an object. Value: `%s`.",e));t=ce(e)}else t={};return t.objectMode=!0,new he(t)},_e=function(e){var t;if(arguments.length){if(!be(e))throw new TypeError(ge("invalid argument. Options argument must be an object. Value: `%s`.",e));t=je(e)}else t={};return r;function r(){return new ve(t)}};we(xe,"objectMode",ye),we(xe,"factory",_e);var Te=xe;export{Te as default,_e as factory,ye as objectMode};
//# sourceMappingURL=index.mjs.map
